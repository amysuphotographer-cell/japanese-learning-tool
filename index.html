<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­åŠ¨è¯å˜å½¢å­¦ä¹ å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .verb-type-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .type-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            font-size: 1em;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-btn:hover {
            background: #f0f0f0;
        }

        .type-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .conjugate-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
        }

        .conjugate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .result-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .result-card .japanese {
            font-size: 2em;
            color: #333;
            margin-bottom: 12px;
            font-weight: bold;
        }

        .result-card .explanation {
            color: #999;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .speak-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .speak-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .speak-btn:active {
            transform: scale(0.95);
        }

        .common-verbs {
            margin-top: 30px;
        }

        .common-verbs h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .verb-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .verb-item {
            padding: 10px 15px;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .verb-item:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .verb-item .verb-jp {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .verb-item .verb-cn {
            font-size: 0.85em;
            color: #666;
        }

        .verb-item:hover .verb-cn {
            color: white;
        }

        .rules-section {
            background: #fff9e6;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .rules-section h3 {
            color: #f57c00;
            margin-bottom: 10px;
        }

        .rules-section ul {
            margin-left: 20px;
            color: #666;
            line-height: 1.8;
        }

        .header-container {
            position: relative;
            margin-bottom: 30px;
        }

        .help-btn {
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            border: none;
            background: none;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #333;
        }

        .help-section {
            margin-bottom: 25px;
        }

        .help-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .help-section ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .help-section p {
            line-height: 1.6;
            color: #666;
        }

        .example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #667eea;
        }

        .example strong {
            color: #667eea;
        }

        .mode-switch {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 30px;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 10px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .practice-mode {
            display: none;
        }

        .practice-mode.show {
            display: block;
        }

        .quiz-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .quiz-question {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .quiz-hint {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .quiz-input {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            font-size: 1.3em;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            margin: 20px auto;
            display: block;
        }

        .quiz-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .quiz-btn {
            padding: 12px 30px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .check-btn {
            background: #667eea;
            color: white;
        }

        .check-btn:hover {
            background: #764ba2;
        }

        .skip-btn {
            background: #ccc;
            color: #666;
        }

        .skip-btn:hover {
            background: #bbb;
        }

        .next-btn {
            background: #4caf50;
            color: white;
        }

        .next-btn:hover {
            background: #45a049;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .answer-display {
            margin-top: 15px;
            padding: 15px;
            background: #fff9e6;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .score-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .type-btn {
                min-width: 100px;
            }

            .modal-content {
                margin: 20px;
                max-height: 90vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <button class="help-btn" onclick="showHelp()">?</button>
            <h1>æ—¥è¯­åŠ¨è¯å˜å½¢å­¦ä¹ å·¥å…·</h1>
            <p class="subtitle">å‹•è©ã®æ´»ç”¨ç·´ç¿’ãƒ„ãƒ¼ãƒ« - è®©æ—¥è¯­åŠ¨è¯å˜å½¢å˜å¾—ç®€å•ï¼</p>
        </div>

        <!-- æ¨¡å¼åˆ‡æ¢ -->
        <div class="mode-switch">
            <button class="mode-btn active" onclick="switchMode('learn')">å­¦ä¹ æ¨¡å¼</button>
            <button class="mode-btn" onclick="switchMode('practice')">ç»ƒä¹ æ¨¡å¼</button>
        </div>

        <!-- å­¦ä¹ æ¨¡å¼ -->
        <div id="learnMode" class="learn-mode">
        <div class="input-section">
            <div class="input-group">
                <label for="verbInput">è¾“å…¥åŠ¨è¯åŸå½¢ï¼ˆè¾æ›¸å½¢ï¼‰ï¼š</label>
                <input type="text" id="verbInput" placeholder="ä¾‹å¦‚ï¼šé£Ÿã¹ã‚‹ã€è¡Œãã€ã™ã‚‹" autocomplete="off">
            </div>

            <div class="input-group">
                <label>åŠ¨è¯ç±»å‹ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼Œå¯æ‰‹åŠ¨ä¿®æ”¹ï¼‰ï¼š</label>
                <div class="verb-type-buttons">
                    <button class="type-btn" data-type="ichidan">ä¸€æ®µåŠ¨è¯ (ã‚‹åŠ¨è¯)</button>
                    <button class="type-btn" data-type="godan">äº”æ®µåŠ¨è¯ (ã†åŠ¨è¯)</button>
                    <button class="type-btn" data-type="irregular">ä¸è§„åˆ™åŠ¨è¯</button>
                </div>
            </div>

            <button class="conjugate-btn" onclick="conjugateVerb()">å¼€å§‹å˜å½¢</button>
        </div>

        <div class="results" id="results">
            <div class="rules-section" id="rulesSection"></div>
            <div class="result-grid" id="resultGrid"></div>
        </div>

        <div class="common-verbs">
            <h2>å¸¸ç”¨åŠ¨è¯å¿«é€Ÿé€‰æ‹©</h2>
            <div class="verb-list" id="verbList"></div>
        </div>
        </div>

        <!-- ç»ƒä¹ æ¨¡å¼ -->
        <div id="practiceMode" class="practice-mode">
            <div class="score-display" id="scoreDisplay">
                æ­£ç¡®ï¼š<span id="correctCount">0</span> / é”™è¯¯ï¼š<span id="wrongCount">0</span> / æ€»è®¡ï¼š<span id="totalCount">0</span>
            </div>

            <div class="quiz-card">
                <div class="quiz-question" id="quizQuestion">åŠ è½½ä¸­...</div>
                <div class="quiz-hint" id="quizHint"></div>
                <button class="speak-btn" onclick="speakText(currentQuiz.verb)" style="margin: 10px auto; display: block;">ğŸ”Š å‘éŸ³</button>

                <input type="text" id="quizInput" class="quiz-input" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" autocomplete="off">

                <div class="quiz-buttons">
                    <button class="quiz-btn check-btn" onclick="checkAnswer()">æ£€æŸ¥ç­”æ¡ˆ</button>
                    <button class="quiz-btn skip-btn" onclick="skipQuestion()">è·³è¿‡</button>
                </div>

                <div id="feedback"></div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="quiz-btn next-btn" onclick="nextQuestion()" style="display: none;" id="nextBtn">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©å¼¹çª— -->
    <div id="helpModal" class="modal" onclick="closeHelp(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeHelp()">&times;</button>
            <h2 style="color: #667eea; margin-bottom: 20px;">ä½¿ç”¨è¯´æ˜</h2>

            <div class="help-section">
                <h3>ğŸ“– å¦‚ä½•ä½¿ç”¨</h3>
                <p><strong>æ–¹æ³•ä¸€ï¼šå¿«é€Ÿé€‰æ‹©</strong></p>
                <ul>
                    <li>åœ¨é¡µé¢åº•éƒ¨ç‚¹å‡»ä»»æ„å¸¸ç”¨åŠ¨è¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ˜¾ç¤ºå…¶æ‰€æœ‰å˜å½¢</li>
                </ul>
                <p><strong>æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è¾“å…¥</strong></p>
                <ul>
                    <li>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ—¥è¯­åŠ¨è¯çš„åŸå½¢ï¼ˆè¾æ›¸å½¢ï¼‰</li>
                    <li>ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«åŠ¨è¯ç±»å‹ï¼ˆä¸€æ®µã€äº”æ®µã€ä¸è§„åˆ™ï¼‰</li>
                    <li>å¦‚æœè¯†åˆ«é”™è¯¯ï¼Œå¯ä»¥æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®ä¿®æ”¹ç±»å‹</li>
                    <li>ç‚¹å‡»"å¼€å§‹å˜å½¢"æŒ‰é’®æŸ¥çœ‹æ‰€æœ‰å˜å½¢ç»“æœ</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>ğŸ“š åŠ¨è¯åˆ†ç±»è¯¦è§£</h3>

                <div class="example">
                    <strong>ä¸€æ®µåŠ¨è¯ï¼ˆã‚‹åŠ¨è¯ï¼‰</strong>
                    <p>â€¢ ç‰¹å¾ï¼šè¯å°¾æ˜¯ã€Œã‚‹ã€ï¼Œä¸”ã‚‹å‰é¢æ˜¯ã€Œã„ã€æ®µæˆ–ã€Œãˆã€æ®µå‡å</p>
                    <p>â€¢ å˜å½¢è§„åˆ™ï¼šå»æ‰ã€Œã‚‹ã€ï¼ŒåŠ ä¸Šç›¸åº”è¯å°¾</p>
                    <p>â€¢ ä¾‹å­ï¼š</p>
                    <ul>
                        <li>é£Ÿã¹ã‚‹ï¼ˆåƒï¼‰â†’ é£Ÿã¹ + ã¾ã™ = é£Ÿã¹ã¾ã™</li>
                        <li>è¦‹ã‚‹ï¼ˆçœ‹ï¼‰â†’ è¦‹ + ã¦ = è¦‹ã¦</li>
                        <li>èµ·ãã‚‹ï¼ˆèµ·åºŠï¼‰â†’ èµ·ã + ãŸ = èµ·ããŸ</li>
                    </ul>
                </div>

                <div class="example">
                    <strong>äº”æ®µåŠ¨è¯ï¼ˆã†åŠ¨è¯ï¼‰</strong>
                    <p>â€¢ ç‰¹å¾ï¼šè¯å°¾æ˜¯ã†æ®µå‡åï¼ˆã†/ã/ã/ã™/ã¤/ã¬/ã¶/ã‚€/ã‚‹ï¼‰</p>
                    <p>â€¢ å˜å½¢è§„åˆ™ï¼šè¯å°¾æŒ‰äº”åéŸ³å›¾çš„æ®µå˜åŒ–</p>
                    <p>â€¢ ä¾‹å­ï¼š</p>
                    <ul>
                        <li>æ›¸ãï¼ˆå†™ï¼‰â†’ æ›¸ãï¼ˆã„æ®µï¼‰+ ã¾ã™ = æ›¸ãã¾ã™</li>
                        <li>é£²ã‚€ï¼ˆå–ï¼‰â†’ é£²ã‚“ï¼ˆã‚“ï¼‰+ ã§ = é£²ã‚“ã§</li>
                        <li>è©±ã™ï¼ˆè¯´ï¼‰â†’ è©±ã—ï¼ˆã—ï¼‰+ ãŸ = è©±ã—ãŸ</li>
                    </ul>
                    <p style="color: #f57c00; margin-top: 10px;">âš ï¸ æ³¨æ„ï¼šæœ‰äº›ä»¥ã€Œã‚‹ã€ç»“å°¾çš„åŠ¨è¯ä¹Ÿæ˜¯äº”æ®µåŠ¨è¯ï¼Œå¦‚ï¼šå¸°ã‚‹ã€èµ°ã‚‹ã€åˆ‡ã‚‹</p>
                </div>

                <div class="example">
                    <strong>ä¸è§„åˆ™åŠ¨è¯</strong>
                    <p>â€¢ åªæœ‰ä¸¤ä¸ªåŸºæœ¬ä¸è§„åˆ™åŠ¨è¯ï¼š</p>
                    <ul>
                        <li><strong>ã™ã‚‹</strong>ï¼ˆåšï¼‰ï¼šã—ã¾ã™ã€ã—ã¦ã€ã—ãŸ</li>
                        <li><strong>æ¥ã‚‹</strong>ï¼ˆæ¥ï¼‰ï¼šæ¥ã¾ã™ã€æ¥ã¦ã€æ¥ãŸ</li>
                    </ul>
                    <p>â€¢ å¤åˆåŠ¨è¯ï¼šä»¥ã€Œã™ã‚‹ã€ç»“å°¾çš„åŠ¨è¯æŒ‰ã€Œã™ã‚‹ã€å˜å½¢</p>
                    <ul>
                        <li>å‹‰å¼·ã™ã‚‹ï¼ˆå­¦ä¹ ï¼‰â†’ å‹‰å¼·ã—ã¾ã™ã€å‹‰å¼·ã—ã¦</li>
                        <li>æ–™ç†ã™ã‚‹ï¼ˆåšèœï¼‰â†’ æ–™ç†ã—ã¾ã™ã€æ–™ç†ã—ã¦</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <h3>ğŸ”„ å¸¸ç”¨å˜å½¢è¯´æ˜</h3>
                <ul>
                    <li><strong>ã¾ã™å½¢ï¼š</strong>ç¤¼è²Œå½¢ï¼Œç”¨äºæ­£å¼åœºåˆ</li>
                    <li><strong>ã¦å½¢ï¼š</strong>è¿æ¥å½¢ï¼Œè¡¨ç¤º"...ç„¶å"æˆ–ç”¨äºè¯·æ±‚</li>
                    <li><strong>ãŸå½¢ï¼š</strong>è¿‡å»å½¢ï¼Œè¡¨ç¤ºè¿‡å»å‘ç”Ÿçš„åŠ¨ä½œ</li>
                    <li><strong>ãªã„å½¢ï¼š</strong>å¦å®šå½¢ï¼Œè¡¨ç¤º"ä¸..."</li>
                    <li><strong>ã°å½¢ï¼š</strong>å‡å®šå½¢ï¼Œè¡¨ç¤º"å¦‚æœ..."</li>
                    <li><strong>å¯èƒ½å½¢ï¼š</strong>è¡¨ç¤º"èƒ½å¤Ÿ..."</li>
                    <li><strong>æ„å¿—å½¢ï¼š</strong>è¡¨ç¤º"è®©æˆ‘ä»¬..."</li>
                    <li><strong>å‘½ä»¤å½¢ï¼š</strong>è¡¨ç¤ºå‘½ä»¤</li>
                    <li><strong>è¢«åŠ¨å½¢ï¼š</strong>è¡¨ç¤ºè¢«åŠ¨</li>
                    <li><strong>ä½¿å½¹å½¢ï¼š</strong>è¡¨ç¤º"è®©...åš"</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>ğŸ’¡ å°æŠ€å·§</h3>
                <ul>
                    <li>æœ¬å·¥å…·å†…ç½®äº†100+å¸¸ç”¨åŠ¨è¯è¯å…¸ï¼Œè¾“å…¥åä¼šè‡ªåŠ¨æ˜¾ç¤ºä¸­æ–‡é‡Šä¹‰</li>
                    <li>ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«åŠ¨è¯ç±»å‹ï¼Œå‡†ç¡®ç‡è¾ƒé«˜</li>
                    <li>å¯¹äºç‰¹æ®ŠåŠ¨è¯ï¼ˆå¦‚å¸°ã‚‹ã€èµ°ã‚‹ç­‰ï¼‰ï¼Œç³»ç»Ÿå·²åšç‰¹æ®Šå¤„ç†</li>
                    <li>æ”¯æŒé”®ç›˜å›è½¦é”®å¿«é€ŸæŸ¥è¯¢</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>ğŸ“ å­¦ä¹ å»ºè®®</h3>
                <ul>
                    <li>å…ˆä»å¸¸ç”¨åŠ¨è¯å¼€å§‹ç»ƒä¹ ï¼Œç†Ÿæ‚‰å˜å½¢è§„å¾‹</li>
                    <li>ä¸€æ®µåŠ¨è¯å˜å½¢ç›¸å¯¹ç®€å•ï¼Œå»ºè®®å…ˆæŒæ¡</li>
                    <li>äº”æ®µåŠ¨è¯éœ€è¦è®°å¿†ä¸åŒè¯å°¾çš„å˜åŒ–è§„å¾‹</li>
                    <li>ã™ã‚‹å’Œæ¥ã‚‹æ˜¯ç‰¹æ®ŠåŠ¨è¯ï¼Œéœ€è¦å•ç‹¬è®°å¿†</li>
                    <li>å¤šç»ƒä¹ ã€å¤šå¯¹æ¯”ï¼Œæ‰¾å‡ºè§„å¾‹</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let selectedType = '';

        // åŠ¨è¯è¯å…¸ï¼ˆåŒ…å«ä¸­æ–‡é‡Šä¹‰ï¼‰
        const verbDictionary = {
            // ä¸€æ®µåŠ¨è¯
            'é£Ÿã¹ã‚‹': 'åƒ',
            'è¦‹ã‚‹': 'çœ‹',
            'èµ·ãã‚‹': 'èµ·åºŠ',
            'å¯ã‚‹': 'ç¡è§‰',
            'æ•™ãˆã‚‹': 'æ•™',
            'ç€ã‚‹': 'ç©¿',
            'é–‹ã‘ã‚‹': 'æ‰“å¼€',
            'é–‰ã‚ã‚‹': 'å…³é—­',
            'è€ƒãˆã‚‹': 'è€ƒè™‘',
            'ç­”ãˆã‚‹': 'å›ç­”',
            'å¿˜ã‚Œã‚‹': 'å¿˜è®°',
            'è¦šãˆã‚‹': 'è®°ä½',
            'å‡ºã‚‹': 'å‡ºå»',
            'å…¥ã‚Œã‚‹': 'æ”¾å…¥',
            'æ¨ã¦ã‚‹': 'æ‰”æ‰',
            'ç–²ã‚Œã‚‹': 'ç–²åŠ³',
            'æ™´ã‚Œã‚‹': 'æ™´å¤©',
            'ç”Ÿãã‚‹': 'æ´»ç€',
            'å€Ÿã‚Šã‚‹': 'å€Ÿ',
            'é™ã‚Šã‚‹': 'ä¸‹è½¦',
            'æµ´ã³ã‚‹': 'æ·‹æµ´',
            'ä¿¡ã˜ã‚‹': 'ç›¸ä¿¡',

            // äº”æ®µåŠ¨è¯
            'è¡Œã': 'å»',
            'æ›¸ã': 'å†™',
            'èª­ã‚€': 'è¯»',
            'è©±ã™': 'è¯´',
            'èã': 'å¬',
            'è²·ã†': 'ä¹°',
            'ä¼šã†': 'è§é¢',
            'å¸°ã‚‹': 'å›å»',
            'å¾…ã¤': 'ç­‰å¾…',
            'é£²ã‚€': 'å–',
            'éŠã¶': 'ç©',
            'æ­»ã¬': 'æ­»',
            'ç«‹ã¤': 'ç«™',
            'åº§ã‚‹': 'å',
            'å£²ã‚‹': 'å–',
            'ä½œã‚‹': 'åˆ¶ä½œ',
            'å–ã‚‹': 'æ‹¿',
            'æ­©ã': 'èµ°è·¯',
            'æ³³ã': 'æ¸¸æ³³',
            'æ€¥ã': 'ç€æ€¥',
            'å‘¼ã¶': 'å«',
            'ä¼‘ã‚€': 'ä¼‘æ¯',
            'ä½ã‚€': 'å±…ä½',
            'å¸ã†': 'å¸',
            'æ´—ã†': 'æ´—',
            'ä½¿ã†': 'ä½¿ç”¨',
            'æ­Œã†': 'å”±æ­Œ',
            'ç¬‘ã†': 'ç¬‘',
            'æŒã¤': 'æŒæœ‰',
            'å‹ã¤': 'èµ¢',
            'æ¶ˆã™': 'å…³é—­/ç†„ç­',
            'è²¸ã™': 'å€Ÿå‡º',
            'å‡ºã™': 'æ‹¿å‡º',
            'è¿”ã™': 'å½’è¿˜',
            'æ¸¡ã™': 'äº¤ç»™',
            'æŠ¼ã™': 'æŒ‰',
            'èµ°ã‚‹': 'è·‘',
            'åˆ‡ã‚‹': 'åˆ‡',
            'çŸ¥ã‚‹': 'çŸ¥é“',
            'å…¥ã‚‹': 'è¿›å…¥',
            'è¦ã‚‹': 'éœ€è¦',
            'ä¹—ã‚‹': 'ä¹˜å',
            'é™ã‚‹': 'ä¸‹é›¨/ä¸‹é›ª',
            'æ’®ã‚‹': 'æ‹æ‘„',
            'åˆ†ã‹ã‚‹': 'æ˜ç™½',
            'å§‹ã¾ã‚‹': 'å¼€å§‹',
            'çµ‚ã‚ã‚‹': 'ç»“æŸ',
            'é ‘å¼µã‚‹': 'åŠ æ²¹',
            'åƒã': 'å·¥ä½œ',
            'å‹•ã': 'ç§»åŠ¨',
            'ç½®ã': 'æ”¾ç½®',
            'å’²ã': 'å¼€èŠ±',
            'å¼¾ã': 'å¼¹å¥',
            'é³´ã': 'é¸£å«',
            'æ³£ã': 'å“­',
            'é–‹ã': 'æ‰“å¼€',
            'å¼•ã': 'æ‹‰',

            // ä¸è§„åˆ™åŠ¨è¯
            'ã™ã‚‹': 'åš',
            'æ¥ã‚‹': 'æ¥',
            'å‹‰å¼·ã™ã‚‹': 'å­¦ä¹ ',
            'æ•£æ­©ã™ã‚‹': 'æ•£æ­¥',
            'æ–™ç†ã™ã‚‹': 'åšèœ',
            'æƒé™¤ã™ã‚‹': 'æ‰“æ‰«',
            'æ´—æ¿¯ã™ã‚‹': 'æ´—è¡£æœ',
            'è²·ã„ç‰©ã™ã‚‹': 'è´­ç‰©',
            'é‹è»¢ã™ã‚‹': 'å¼€è½¦',
            'é›»è©±ã™ã‚‹': 'æ‰“ç”µè¯',
            'çµå©šã™ã‚‹': 'ç»“å©š',
            'ä»•äº‹ã™ã‚‹': 'å·¥ä½œ',
            'æ—…è¡Œã™ã‚‹': 'æ—…è¡Œ',
            'äºˆç´„ã™ã‚‹': 'é¢„çº¦',
            'ç´¹ä»‹ã™ã‚‹': 'ä»‹ç»',
            'èª¬æ˜ã™ã‚‹': 'è¯´æ˜',
            'æº–å‚™ã™ã‚‹': 'å‡†å¤‡',
            'ç·´ç¿’ã™ã‚‹': 'ç»ƒä¹ '
        };

        // å¸¸ç”¨åŠ¨è¯åˆ—è¡¨
        const commonVerbs = [
            // ä¸€æ®µåŠ¨è¯
            { jp: 'é£Ÿã¹ã‚‹', cn: 'åƒ', type: 'ichidan' },
            { jp: 'è¦‹ã‚‹', cn: 'çœ‹', type: 'ichidan' },
            { jp: 'èµ·ãã‚‹', cn: 'èµ·åºŠ', type: 'ichidan' },
            { jp: 'å¯ã‚‹', cn: 'ç¡è§‰', type: 'ichidan' },
            { jp: 'æ•™ãˆã‚‹', cn: 'æ•™', type: 'ichidan' },
            { jp: 'ç€ã‚‹', cn: 'ç©¿', type: 'ichidan' },
            { jp: 'é–‹ã‘ã‚‹', cn: 'æ‰“å¼€', type: 'ichidan' },
            { jp: 'é–‰ã‚ã‚‹', cn: 'å…³é—­', type: 'ichidan' },

            // äº”æ®µåŠ¨è¯
            { jp: 'è¡Œã', cn: 'å»', type: 'godan' },
            { jp: 'æ›¸ã', cn: 'å†™', type: 'godan' },
            { jp: 'èª­ã‚€', cn: 'è¯»', type: 'godan' },
            { jp: 'è©±ã™', cn: 'è¯´', type: 'godan' },
            { jp: 'èã', cn: 'å¬', type: 'godan' },
            { jp: 'è²·ã†', cn: 'ä¹°', type: 'godan' },
            { jp: 'ä¼šã†', cn: 'è§é¢', type: 'godan' },
            { jp: 'å¸°ã‚‹', cn: 'å›å»', type: 'godan' },
            { jp: 'å¾…ã¤', cn: 'ç­‰å¾…', type: 'godan' },
            { jp: 'é£²ã‚€', cn: 'å–', type: 'godan' },
            { jp: 'éŠã¶', cn: 'ç©', type: 'godan' },
            { jp: 'æ­»ã¬', cn: 'æ­»', type: 'godan' },

            // ä¸è§„åˆ™åŠ¨è¯
            { jp: 'ã™ã‚‹', cn: 'åš', type: 'irregular' },
            { jp: 'æ¥ã‚‹', cn: 'æ¥', type: 'irregular' },
            { jp: 'å‹‰å¼·ã™ã‚‹', cn: 'å­¦ä¹ ', type: 'irregular' },
            { jp: 'æ•£æ­©ã™ã‚‹', cn: 'æ•£æ­¥', type: 'irregular' }
        ];

        // è·å–åŠ¨è¯çš„ä¸­æ–‡é‡Šä¹‰
        function getVerbMeaning(verb) {
            return verbDictionary[verb] || null;
        }

        // åˆå§‹åŒ–å¸¸ç”¨åŠ¨è¯åˆ—è¡¨
        function initVerbList() {
            const verbList = document.getElementById('verbList');
            commonVerbs.forEach(verb => {
                const item = document.createElement('div');
                item.className = 'verb-item';
                item.innerHTML = `
                    <div class="verb-jp">${verb.jp}</div>
                    <div class="verb-cn">${verb.cn}</div>
                `;
                item.onclick = () => selectVerb(verb.jp, verb.type);
                verbList.appendChild(item);
            });
        }

        // é€‰æ‹©åŠ¨è¯
        function selectVerb(verb, type) {
            document.getElementById('verbInput').value = verb;
            selectedType = type;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.type === type) {
                    btn.classList.add('active');
                }
            });

            // è‡ªåŠ¨å˜å½¢
            conjugateVerb();
        }

        // åŠ¨è¯ç±»å‹é€‰æ‹©
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedType = this.dataset.type;
            });
        });

        // è‡ªåŠ¨æ£€æµ‹åŠ¨è¯ç±»å‹
        function detectVerbType(verb) {
            if (!verb) return null;

            // ä¸è§„åˆ™åŠ¨è¯æ£€æµ‹
            if (verb === 'ã™ã‚‹' || verb === 'æ¥ã‚‹' || verb.endsWith('ã™ã‚‹')) {
                return 'irregular';
            }

            // å¿…é¡»ä»¥ã‚‹ç»“å°¾æ‰å¯èƒ½æ˜¯ä¸€æ®µåŠ¨è¯
            if (!verb.endsWith('ã‚‹')) {
                return 'godan';
            }

            // æ£€æŸ¥ã‚‹å‰é¢çš„å‡å
            if (verb.length >= 2) {
                const beforeRu = verb.charAt(verb.length - 2);

                // ã„æ®µå‡åï¼šã„ã€ãã€ãã€ã—ã€ã˜ã€ã¡ã€ã¢ã€ã«ã€ã²ã€ã³ã€ã´ã€ã¿ã€ã‚Š
                const iDan = ['ã„', 'ã', 'ã', 'ã—', 'ã˜', 'ã¡', 'ã¢', 'ã«', 'ã²', 'ã³', 'ã´', 'ã¿', 'ã‚Š'];

                // ãˆæ®µå‡åï¼šãˆã€ã‘ã€ã’ã€ã›ã€ãœã€ã¦ã€ã§ã€ã­ã€ã¸ã€ã¹ã€ãºã€ã‚ã€ã‚Œ
                const eDan = ['ãˆ', 'ã‘', 'ã’', 'ã›', 'ãœ', 'ã¦', 'ã§', 'ã­', 'ã¸', 'ã¹', 'ãº', 'ã‚', 'ã‚Œ'];

                // å¸¸è§çš„äº”æ®µã‚‹åŠ¨è¯ï¼ˆç‰¹æ®Šæƒ…å†µï¼‰
                const godanRuVerbs = ['å¸°ã‚‹', 'èµ°ã‚‹', 'åˆ‡ã‚‹', 'çŸ¥ã‚‹', 'å…¥ã‚‹', 'è¦ã‚‹', 'ç…§ã‚‹', 'æ¸›ã‚‹', 'å‚ã‚‹', 'è¹´ã‚‹', 'ç„¦ã‚‹', 'æ»‘ã‚‹', 'é™ã‚‹', 'ç·´ã‚‹', 'æ¡ã‚‹', 'ç½µã‚‹'];

                if (godanRuVerbs.includes(verb)) {
                    return 'godan';
                }

                // å¦‚æœã‚‹å‰é¢æ˜¯ã„æ®µæˆ–ãˆæ®µï¼Œé€šå¸¸æ˜¯ä¸€æ®µåŠ¨è¯
                if (iDan.includes(beforeRu) || eDan.includes(beforeRu)) {
                    return 'ichidan';
                }
            }

            // é»˜è®¤ä¸ºäº”æ®µåŠ¨è¯
            return 'godan';
        }

        // è¾“å…¥æ¡†å˜åŒ–æ—¶è‡ªåŠ¨æ£€æµ‹ç±»å‹
        document.getElementById('verbInput').addEventListener('input', function() {
            const verb = this.value.trim();
            const detectedType = detectVerbType(verb);

            if (detectedType) {
                selectedType = detectedType;

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.type-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.type === detectedType) {
                        btn.classList.add('active');
                    }
                });
            }
        });

        // ä¸€æ®µåŠ¨è¯å˜å½¢
        function conjugateIchidan(verb) {
            const stem = verb.slice(0, -1); // å»æ‰ã‚‹

            return {
                masu: { jp: stem + 'ã¾ã™', romaji: 'masu-kei', meaning: 'ç¤¼è²Œå½¢ï¼Œç”¨äºæ­£å¼åœºåˆ' },
                te: { jp: stem + 'ã¦', romaji: 'te-kei', meaning: 'è¿æ¥å½¢ï¼Œè¡¨ç¤º"...ç„¶å"æˆ–è¯·æ±‚' },
                ta: { jp: stem + 'ãŸ', romaji: 'ta-kei', meaning: 'è¿‡å»å½¢ï¼Œè¡¨ç¤ºè¿‡å»çš„åŠ¨ä½œ' },
                nai: { jp: stem + 'ãªã„', romaji: 'nai-kei', meaning: 'å¦å®šå½¢ï¼Œè¡¨ç¤º"ä¸..."' },
                nakatta: { jp: stem + 'ãªã‹ã£ãŸ', romaji: 'nakatta-kei', meaning: 'è¿‡å»å¦å®šå½¢' },
                ba: { jp: stem + 'ã‚Œã°', romaji: 'ba-kei', meaning: 'å‡å®šå½¢ï¼Œè¡¨ç¤º"å¦‚æœ..."' },
                potential: { jp: stem + 'ã‚‰ã‚Œã‚‹', romaji: 'kanoukei', meaning: 'å¯èƒ½å½¢ï¼Œè¡¨ç¤º"èƒ½å¤Ÿ..."' },
                volitional: { jp: stem + 'ã‚ˆã†', romaji: 'ishikei', meaning: 'æ„å¿—å½¢ï¼Œè¡¨ç¤º"è®©æˆ‘ä»¬..."' },
                imperative: { jp: stem + 'ã‚', romaji: 'meireikei', meaning: 'å‘½ä»¤å½¢ï¼Œè¡¨ç¤ºå‘½ä»¤' },
                passive: { jp: stem + 'ã‚‰ã‚Œã‚‹', romaji: 'ukemikei', meaning: 'è¢«åŠ¨å½¢ï¼Œè¡¨ç¤ºè¢«åŠ¨' },
                causative: { jp: stem + 'ã•ã›ã‚‹', romaji: 'shiekikei', meaning: 'ä½¿å½¹å½¢ï¼Œè¡¨ç¤º"è®©...åš"' }
            };
        }

        // äº”æ®µåŠ¨è¯å˜å½¢
        function conjugateGodan(verb) {
            const lastChar = verb.slice(-1);
            const stem = verb.slice(0, -1);

            // è¯å°¾å¯¹åº”å…³ç³»
            const conjugations = {
                'ã†': { i: 'ã„', e: 'ãˆ', a: 'ã‚', o: 'ãŠ', te: 'ã£ã¦', ta: 'ã£ãŸ' },
                'ã': { i: 'ã', e: 'ã‘', a: 'ã‹', o: 'ã“', te: 'ã„ã¦', ta: 'ã„ãŸ' },
                'ã': { i: 'ã', e: 'ã’', a: 'ãŒ', o: 'ã”', te: 'ã„ã§', ta: 'ã„ã ' },
                'ã™': { i: 'ã—', e: 'ã›', a: 'ã•', o: 'ã', te: 'ã—ã¦', ta: 'ã—ãŸ' },
                'ã¤': { i: 'ã¡', e: 'ã¦', a: 'ãŸ', o: 'ã¨', te: 'ã£ã¦', ta: 'ã£ãŸ' },
                'ã¬': { i: 'ã«', e: 'ã­', a: 'ãª', o: 'ã®', te: 'ã‚“ã§', ta: 'ã‚“ã ' },
                'ã¶': { i: 'ã³', e: 'ã¹', a: 'ã°', o: 'ã¼', te: 'ã‚“ã§', ta: 'ã‚“ã ' },
                'ã‚€': { i: 'ã¿', e: 'ã‚', a: 'ã¾', o: 'ã‚‚', te: 'ã‚“ã§', ta: 'ã‚“ã ' },
                'ã‚‹': { i: 'ã‚Š', e: 'ã‚Œ', a: 'ã‚‰', o: 'ã‚', te: 'ã£ã¦', ta: 'ã£ãŸ' }
            };

            const conj = conjugations[lastChar];

            // ç‰¹æ®Šå¤„ç†ï¼šè¡Œã
            if (verb === 'è¡Œã') {
                return {
                    masu: { jp: 'è¡Œãã¾ã™', romaji: 'masu-kei', meaning: 'ç¤¼è²Œå½¢' },
                    te: { jp: 'è¡Œã£ã¦', romaji: 'te-kei', meaning: 'è¿æ¥å½¢' },
                    ta: { jp: 'è¡Œã£ãŸ', romaji: 'ta-kei', meaning: 'è¿‡å»å½¢' },
                    nai: { jp: 'è¡Œã‹ãªã„', romaji: 'nai-kei', meaning: 'å¦å®šå½¢' },
                    nakatta: { jp: 'è¡Œã‹ãªã‹ã£ãŸ', romaji: 'nakatta-kei', meaning: 'è¿‡å»å¦å®šå½¢' },
                    ba: { jp: 'è¡Œã‘ã°', romaji: 'ba-kei', meaning: 'å‡å®šå½¢' },
                    potential: { jp: 'è¡Œã‘ã‚‹', romaji: 'kanoukei', meaning: 'å¯èƒ½å½¢' },
                    volitional: { jp: 'è¡Œã“ã†', romaji: 'ishikei', meaning: 'æ„å¿—å½¢' },
                    imperative: { jp: 'è¡Œã‘', romaji: 'meireikei', meaning: 'å‘½ä»¤å½¢' },
                    passive: { jp: 'è¡Œã‹ã‚Œã‚‹', romaji: 'ukemikei', meaning: 'è¢«åŠ¨å½¢' },
                    causative: { jp: 'è¡Œã‹ã›ã‚‹', romaji: 'shiekikei', meaning: 'ä½¿å½¹å½¢' }
                };
            }

            return {
                masu: { jp: stem + conj.i + 'ã¾ã™', romaji: 'masu-kei', meaning: 'ç¤¼è²Œå½¢ï¼Œç”¨äºæ­£å¼åœºåˆ' },
                te: { jp: stem + conj.te, romaji: 'te-kei', meaning: 'è¿æ¥å½¢ï¼Œè¡¨ç¤º"...ç„¶å"æˆ–è¯·æ±‚' },
                ta: { jp: stem + conj.ta, romaji: 'ta-kei', meaning: 'è¿‡å»å½¢ï¼Œè¡¨ç¤ºè¿‡å»çš„åŠ¨ä½œ' },
                nai: { jp: stem + conj.a + 'ãªã„', romaji: 'nai-kei', meaning: 'å¦å®šå½¢ï¼Œè¡¨ç¤º"ä¸..."' },
                nakatta: { jp: stem + conj.a + 'ãªã‹ã£ãŸ', romaji: 'nakatta-kei', meaning: 'è¿‡å»å¦å®šå½¢' },
                ba: { jp: stem + conj.e + 'ã°', romaji: 'ba-kei', meaning: 'å‡å®šå½¢ï¼Œè¡¨ç¤º"å¦‚æœ..."' },
                potential: { jp: stem + conj.e + 'ã‚‹', romaji: 'kanoukei', meaning: 'å¯èƒ½å½¢ï¼Œè¡¨ç¤º"èƒ½å¤Ÿ..."' },
                volitional: { jp: stem + conj.o + 'ã†', romaji: 'ishikei', meaning: 'æ„å¿—å½¢ï¼Œè¡¨ç¤º"è®©æˆ‘ä»¬..."' },
                imperative: { jp: stem + conj.e, romaji: 'meireikei', meaning: 'å‘½ä»¤å½¢ï¼Œè¡¨ç¤ºå‘½ä»¤' },
                passive: { jp: stem + conj.a + 'ã‚Œã‚‹', romaji: 'ukemikei', meaning: 'è¢«åŠ¨å½¢ï¼Œè¡¨ç¤ºè¢«åŠ¨' },
                causative: { jp: stem + conj.a + 'ã›ã‚‹', romaji: 'shiekikei', meaning: 'ä½¿å½¹å½¢ï¼Œè¡¨ç¤º"è®©...åš"' }
            };
        }

        // ä¸è§„åˆ™åŠ¨è¯å˜å½¢
        function conjugateIrregular(verb) {
            if (verb === 'ã™ã‚‹' || verb.endsWith('ã™ã‚‹')) {
                const prefix = verb.slice(0, -2);
                return {
                    masu: { jp: prefix + 'ã—ã¾ã™', romaji: 'masu-kei', meaning: 'ç¤¼è²Œå½¢' },
                    te: { jp: prefix + 'ã—ã¦', romaji: 'te-kei', meaning: 'è¿æ¥å½¢' },
                    ta: { jp: prefix + 'ã—ãŸ', romaji: 'ta-kei', meaning: 'è¿‡å»å½¢' },
                    nai: { jp: prefix + 'ã—ãªã„', romaji: 'nai-kei', meaning: 'å¦å®šå½¢' },
                    nakatta: { jp: prefix + 'ã—ãªã‹ã£ãŸ', romaji: 'nakatta-kei', meaning: 'è¿‡å»å¦å®šå½¢' },
                    ba: { jp: prefix + 'ã™ã‚Œã°', romaji: 'ba-kei', meaning: 'å‡å®šå½¢' },
                    potential: { jp: prefix + 'ã§ãã‚‹', romaji: 'kanoukei', meaning: 'å¯èƒ½å½¢' },
                    volitional: { jp: prefix + 'ã—ã‚ˆã†', romaji: 'ishikei', meaning: 'æ„å¿—å½¢' },
                    imperative: { jp: prefix + 'ã—ã‚', romaji: 'meireikei', meaning: 'å‘½ä»¤å½¢' },
                    passive: { jp: prefix + 'ã•ã‚Œã‚‹', romaji: 'ukemikei', meaning: 'è¢«åŠ¨å½¢' },
                    causative: { jp: prefix + 'ã•ã›ã‚‹', romaji: 'shiekikei', meaning: 'ä½¿å½¹å½¢' }
                };
            } else if (verb === 'æ¥ã‚‹') {
                return {
                    masu: { jp: 'æ¥ã¾ã™', romaji: 'kimasu', meaning: 'ç¤¼è²Œå½¢' },
                    te: { jp: 'æ¥ã¦', romaji: 'kite', meaning: 'è¿æ¥å½¢' },
                    ta: { jp: 'æ¥ãŸ', romaji: 'kita', meaning: 'è¿‡å»å½¢' },
                    nai: { jp: 'æ¥ãªã„', romaji: 'konai', meaning: 'å¦å®šå½¢' },
                    nakatta: { jp: 'æ¥ãªã‹ã£ãŸ', romaji: 'konakatta', meaning: 'è¿‡å»å¦å®šå½¢' },
                    ba: { jp: 'æ¥ã‚Œã°', romaji: 'kureba', meaning: 'å‡å®šå½¢' },
                    potential: { jp: 'æ¥ã‚‰ã‚Œã‚‹', romaji: 'korareru', meaning: 'å¯èƒ½å½¢' },
                    volitional: { jp: 'æ¥ã‚ˆã†', romaji: 'koyou', meaning: 'æ„å¿—å½¢' },
                    imperative: { jp: 'æ¥ã„', romaji: 'koi', meaning: 'å‘½ä»¤å½¢' },
                    passive: { jp: 'æ¥ã‚‰ã‚Œã‚‹', romaji: 'korareru', meaning: 'è¢«åŠ¨å½¢' },
                    causative: { jp: 'æ¥ã•ã›ã‚‹', romaji: 'kosaseru', meaning: 'ä½¿å½¹å½¢' }
                };
            }
        }

        // è·å–è§„åˆ™è¯´æ˜
        function getRules(type) {
            const rules = {
                ichidan: `
                    <h3>ä¸€æ®µåŠ¨è¯å˜å½¢è§„åˆ™</h3>
                    <ul>
                        <li>ç‰¹å¾ï¼šè¯å°¾ä¸ºã€Œã‚‹ã€ï¼Œä¸”ã‚‹å‰é¢æ˜¯ã€Œã„ã€æˆ–ã€Œãˆã€æ®µå‡å</li>
                        <li>å˜å½¢æ–¹æ³•ï¼šå»æ‰ã€Œã‚‹ã€ï¼ŒåŠ ä¸Šç›¸åº”çš„è¯å°¾</li>
                        <li>ä¾‹å¦‚ï¼šé£Ÿã¹ã‚‹ â†’ é£Ÿã¹ï¼ˆè¯å¹²ï¼‰+ ã¾ã™/ã¦/ãŸç­‰</li>
                    </ul>
                `,
                godan: `
                    <h3>äº”æ®µåŠ¨è¯å˜å½¢è§„åˆ™</h3>
                    <ul>
                        <li>ç‰¹å¾ï¼šè¯å°¾ä¸ºã†æ®µå‡åï¼ˆã†/ã/ã/ã™/ã¤/ã¬/ã¶/ã‚€/ã‚‹ï¼‰</li>
                        <li>å˜å½¢æ–¹æ³•ï¼šè¯å°¾æŒ‰ç…§äº”åéŸ³å›¾çš„æ®µè¿›è¡Œå˜åŒ–</li>
                        <li>ä¾‹å¦‚ï¼šæ›¸ã â†’ æ›¸ãï¼ˆã„æ®µï¼‰/æ›¸ã„ï¼ˆã„æ®µ+ã¦/ãŸï¼‰ç­‰</li>
                        <li>ç‰¹æ®Šï¼šè¡Œãçš„ã¦å½¢å’ŒãŸå½¢æ˜¯ã€Œè¡Œã£ã¦ã€ã€Œè¡Œã£ãŸã€</li>
                    </ul>
                `,
                irregular: `
                    <h3>ä¸è§„åˆ™åŠ¨è¯å˜å½¢è§„åˆ™</h3>
                    <ul>
                        <li>ã™ã‚‹ï¼šåšã€è¿›è¡Œï¼ˆã‚µå¤‰åŠ¨è¯ï¼‰</li>
                        <li>æ¥ã‚‹ï¼ˆãã‚‹ï¼‰ï¼šæ¥ï¼ˆã‚«å¤‰åŠ¨è¯ï¼‰</li>
                        <li>å¤åˆåŠ¨è¯ï¼šå¦‚ã€Œå‹‰å¼·ã™ã‚‹ã€ã€Œæ•£æ­©ã™ã‚‹ã€ç­‰ï¼Œã™ã‚‹éƒ¨åˆ†æŒ‰ã™ã‚‹å˜å½¢</li>
                        <li>è¿™ä¸¤ä¸ªåŠ¨è¯éœ€è¦ç‰¹åˆ«è®°å¿†å…¶å˜å½¢</li>
                    </ul>
                `
            };
            return rules[type] || '';
        }

        // ä¸»å˜å½¢å‡½æ•°
        function conjugateVerb() {
            const verb = document.getElementById('verbInput').value.trim();

            if (!verb) {
                alert('è¯·è¾“å…¥åŠ¨è¯ï¼');
                return;
            }

            if (!selectedType) {
                alert('è¯·é€‰æ‹©åŠ¨è¯ç±»å‹ï¼');
                return;
            }

            let conjugations;

            switch(selectedType) {
                case 'ichidan':
                    if (!verb.endsWith('ã‚‹')) {
                        alert('ä¸€æ®µåŠ¨è¯å¿…é¡»ä»¥ã€Œã‚‹ã€ç»“å°¾ï¼');
                        return;
                    }
                    conjugations = conjugateIchidan(verb);
                    break;
                case 'godan':
                    conjugations = conjugateGodan(verb);
                    break;
                case 'irregular':
                    conjugations = conjugateIrregular(verb);
                    break;
            }

            displayResults(verb, conjugations, selectedType);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(verb, conjugations, type) {
            const resultGrid = document.getElementById('resultGrid');
            const rulesSection = document.getElementById('rulesSection');
            const results = document.getElementById('results');

            // è·å–åŠ¨è¯çš„ä¸­æ–‡æ„æ€
            const meaning = getVerbMeaning(verb);
            const verbTitle = meaning ? `${verb}ï¼ˆ${meaning}ï¼‰` : verb;

            // æ˜¾ç¤ºè§„åˆ™ï¼ŒåŒ…å«åŠ¨è¯åŠå…¶ä¸­æ–‡æ„æ€
            let rulesHTML = `<h3 style="color: #333; font-size: 1.3em; margin-bottom: 15px;">åŠ¨è¯ï¼š${verbTitle}</h3>`;
            rulesHTML += getRules(type);
            rulesSection.innerHTML = rulesHTML;

            // æ˜¾ç¤ºå˜å½¢ç»“æœ
            resultGrid.innerHTML = '';

            const formNames = {
                masu: 'ã¾ã™å½¢',
                te: 'ã¦å½¢',
                ta: 'ãŸå½¢ï¼ˆè¿‡å»å½¢ï¼‰',
                nai: 'ãªã„å½¢ï¼ˆå¦å®šå½¢ï¼‰',
                nakatta: 'ãªã‹ã£ãŸå½¢',
                ba: 'ã°å½¢ï¼ˆå‡å®šå½¢ï¼‰',
                potential: 'å¯èƒ½å½¢',
                volitional: 'æ„å¿—å½¢',
                imperative: 'å‘½ä»¤å½¢',
                passive: 'è¢«åŠ¨å½¢',
                causative: 'ä½¿å½¹å½¢'
            };

            Object.keys(conjugations).forEach(key => {
                const form = conjugations[key];
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <h3>${formNames[key]}</h3>
                    <div class="japanese">${form.jp}</div>
                    <div class="hiragana-reading" style="font-size: 1.3em; color: #667eea; margin: 8px 0; font-weight: 500;">
                        ã²ã‚‰ãŒãªï¼š${form.jp}
                    </div>
                    <div class="romaji">${form.romaji}</div>
                    <div class="explanation">${form.meaning}</div>
                    <button class="speak-btn" onclick="speakText('${form.jp}')">ğŸ”Š å‘éŸ³</button>
                `;
                resultGrid.appendChild(card);
            });

            results.classList.add('show');
            results.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // å›è½¦é”®è§¦å‘
        document.getElementById('verbInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                conjugateVerb();
            }
        });

        // å‘éŸ³åŠŸèƒ½ - ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå°½é‡è‡ªç„¶çš„æ—¥è¯­å‘éŸ³
        let availableVoices = [];

        // åŠ è½½å¯ç”¨è¯­éŸ³åˆ—è¡¨
        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
        }

        if ('speechSynthesis' in window) {
            loadVoices();
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                // å–æ¶ˆå½“å‰æ­£åœ¨è¿›è¡Œçš„è¯­éŸ³
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);

                // æ™ºèƒ½é€‰æ‹©æœ€ä½³æ—¥è¯­è¯­éŸ³
                // ä¼˜å…ˆçº§ï¼š1.åŸç”Ÿå¥³å£° 2.åŸç”Ÿè¯­éŸ³ 3.ä»»ä½•æ—¥è¯­è¯­éŸ³
                const japaneseVoice = availableVoices.find(voice =>
                    voice.lang === 'ja-JP' && voice.localService && voice.name.includes('Kyoko')
                ) || availableVoices.find(voice =>
                    voice.lang === 'ja-JP' && voice.localService
                ) || availableVoices.find(voice =>
                    (voice.lang === 'ja-JP' || voice.lang.startsWith('ja')) &&
                    (voice.name.includes('Female') || voice.name.includes('Kyoko') || voice.name.includes('Otoya'))
                ) || availableVoices.find(voice =>
                    voice.lang === 'ja-JP' || voice.lang.startsWith('ja')
                );

                if (japaneseVoice) {
                    utterance.voice = japaneseVoice;
                    console.log('ä½¿ç”¨è¯­éŸ³ï¼š' + japaneseVoice.name);
                }

                utterance.lang = 'ja-JP';
                utterance.rate = 0.9;   // æ¥è¿‘æ­£å¸¸è¯­é€Ÿ
                utterance.pitch = 1.1;  // ç¨é«˜éŸ³è°ƒï¼Œæ›´æ¸©æŸ”
                utterance.volume = 1.0;

                window.speechSynthesis.speak(utterance);
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½');
            }
        }

        // æ¨¡å¼åˆ‡æ¢
        let currentMode = 'learn';

        function switchMode(mode) {
            currentMode = mode;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // åˆ‡æ¢æ˜¾ç¤ºçš„å†…å®¹
            if (mode === 'learn') {
                document.getElementById('learnMode').style.display = 'block';
                document.getElementById('practiceMode').classList.remove('show');
            } else {
                document.getElementById('learnMode').style.display = 'none';
                document.getElementById('practiceMode').classList.add('show');
                initPractice();
            }
        }

        // ç»ƒä¹ æ¨¡å¼ç›¸å…³å˜é‡
        let currentQuiz = null;
        let correctCount = 0;
        let wrongCount = 0;
        let totalCount = 0;
        let hasAnswered = false;

        // æ‰€æœ‰å˜å½¢ç±»å‹
        const formTypes = ['masu', 'te', 'ta', 'nai', 'nakatta', 'ba', 'potential', 'volitional', 'imperative', 'passive', 'causative'];
        const formNamesForQuiz = {
            masu: 'ã¾ã™å½¢',
            te: 'ã¦å½¢',
            ta: 'ãŸå½¢',
            nai: 'ãªã„å½¢',
            nakatta: 'ãªã‹ã£ãŸå½¢',
            ba: 'ã°å½¢',
            potential: 'å¯èƒ½å½¢',
            volitional: 'æ„å¿—å½¢',
            imperative: 'å‘½ä»¤å½¢',
            passive: 'è¢«åŠ¨å½¢',
            causative: 'ä½¿å½¹å½¢'
        };

        // åˆå§‹åŒ–ç»ƒä¹ æ¨¡å¼
        function initPractice() {
            correctCount = 0;
            wrongCount = 0;
            totalCount = 0;
            updateScore();
            generateQuestion();
        }

        // ç”Ÿæˆé¢˜ç›®
        function generateQuestion() {
            hasAnswered = false;
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('quizInput').value = '';
            document.getElementById('quizInput').disabled = false;

            // éšæœºé€‰æ‹©ä¸€ä¸ªåŠ¨è¯
            const verb = commonVerbs[Math.floor(Math.random() * commonVerbs.length)];

            // éšæœºé€‰æ‹©ä¸€ä¸ªå˜å½¢ç±»å‹
            const formType = formTypes[Math.floor(Math.random() * formTypes.length)];

            // ç”Ÿæˆæ­£ç¡®ç­”æ¡ˆ
            let conjugations;
            switch(verb.type) {
                case 'ichidan':
                    conjugations = conjugateIchidan(verb.jp);
                    break;
                case 'godan':
                    conjugations = conjugateGodan(verb.jp);
                    break;
                case 'irregular':
                    conjugations = conjugateIrregular(verb.jp);
                    break;
            }

            currentQuiz = {
                verb: verb.jp,
                meaning: verb.cn,
                formType: formType,
                answer: conjugations[formType].jp
            };

            // æ˜¾ç¤ºé¢˜ç›®
            document.getElementById('quizQuestion').textContent = currentQuiz.verb;
            document.getElementById('quizHint').textContent = `${currentQuiz.meaning} - è¯·å†™å‡º${formNamesForQuiz[formType]}`;
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            if (hasAnswered) return;

            const userAnswer = document.getElementById('quizInput').value.trim();
            const feedback = document.getElementById('feedback');

            if (!userAnswer) {
                alert('è¯·è¾“å…¥ç­”æ¡ˆï¼');
                return;
            }

            hasAnswered = true;
            totalCount++;
            document.getElementById('quizInput').disabled = true;

            if (userAnswer === currentQuiz.answer) {
                correctCount++;
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                    âœ“ æ­£ç¡®ï¼
                    <div style="margin-top: 10px; font-size: 1.2em; color: #155724;">
                        âœ¨ ${currentQuiz.answer}
                    </div>
                `;
                speakText(currentQuiz.answer);
            } else {
                wrongCount++;
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `
                    âœ— é”™è¯¯
                    <div class="answer-display">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>${currentQuiz.answer}
                        <div style="margin-top: 8px; color: #f57c00; font-size: 1.1em;">
                            ã²ã‚‰ãŒãªï¼š${currentQuiz.answer}
                        </div>
                    </div>
                `;
            }

            updateScore();
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        // è·³è¿‡é¢˜ç›®
        function skipQuestion() {
            if (hasAnswered) return;

            hasAnswered = true;
            totalCount++;
            wrongCount++;

            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback incorrect';
            feedback.innerHTML = `
                å·²è·³è¿‡
                <div class="answer-display">
                    <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>${currentQuiz.answer}
                    <div style="margin-top: 8px; color: #f57c00; font-size: 1.1em;">
                        ã²ã‚‰ãŒãªï¼š${currentQuiz.answer}
                    </div>
                </div>
            `;

            document.getElementById('quizInput').disabled = true;
            updateScore();
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            generateQuestion();
        }

        // æ›´æ–°åˆ†æ•°
        function updateScore() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('totalCount').textContent = totalCount;
        }

        // ç»ƒä¹ æ¨¡å¼å›è½¦é”®æäº¤
        document.getElementById('quizInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (!hasAnswered) {
                    checkAnswer();
                } else {
                    nextQuestion();
                }
            }
        });

        // æ˜¾ç¤ºå¸®åŠ©å¼¹çª—
        function showHelp() {
            document.getElementById('helpModal').classList.add('show');
        }

        // å…³é—­å¸®åŠ©å¼¹çª—
        function closeHelp(event) {
            if (!event || event.target === document.getElementById('helpModal')) {
                document.getElementById('helpModal').classList.remove('show');
            }
        }

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeHelp();
            }
        });

        // åˆå§‹åŒ–
        initVerbList();
    </script>
</body>
</html>